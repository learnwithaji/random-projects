<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Embeddable Label Printer</title>
    
    <!-- 1. Load Tailwind CSS CDN for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 2. Load React, ReactDOM, and Babel for JSX compilation -->
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Configure Tailwind to use the Inter font -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        
        /* Ensure the body font is Inter and the embedding is clean */
        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 0;
            background-color: transparent !important; /* Important for embedding */
        }
    </style>
</head>
<body>

    <!-- This is the container where the React app will render -->
    <div id="root"></div>

    <script type="text/babel">
        // 3. Define the React Component using the Babel type
        
        // --- Lucide-React Icons (Simplified Inline SVGs) ---
        const LucideIcon = ({ icon, className = "w-5 h-5", stroke = "currentColor" }) => (
            <svg 
                xmlns="http://www.w3.org/2000/svg" 
                width="24" 
                height="24" 
                viewBox="0 0 24 24" 
                fill="none" 
                stroke={stroke} 
                strokeWidth="2" 
                strokeLinecap="round" 
                strokeLinejoin="round" 
                className={className}
            >
                {icon}
            </svg>
        );

        const Printer = (props) => (
            <LucideIcon {...props} icon={(
                <>
                    <polyline points="6 9 6 2 18 2 18 9" />
                    <path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2" />
                    <rect x="6" y="14" width="12" height="8" />
                </>
            )}/>
        );
        const Type = (props) => (
            <LucideIcon {...props} icon={(
                <>
                    <polyline points="4 7 4 4 20 4 20 7" />
                    <line x1="9" x2="15" y1="20" y2="20" />
                    <line x1="12" x2="12" y1="4" y2="20" />
                </>
            )}/>
        );
        const LayoutGrid = (props) => (
             <LucideIcon {...props} icon={(
                <>
                    <rect width="18" height="18" x="3" y="3" rx="2" ry="2"/>
                    <line x1="3" x2="21" y1="9" y2="9"/>
                    <line x1="3" x2="21" y1="15" y2="15"/>
                    <line x1="9" x2="9" y1="3" y2="21"/>
                    <line x1="15" x2="15" y1="3" y2="21"/>
                </>
            )}/>
        );
        const Bold = (props) => (
            <LucideIcon {...props} icon={(
                <>
                    <path d="M6 12h9a4 4 0 0 1 4 4v0a4 4 0 0 1-4 4H6z" />
                    <path d="M6 12h9a4 4 0 0 0 4-4V8a4 4 0 0 0-4-4H6z" />
                </>
            )}/>
        );
        const Columns = (props) => (
            <LucideIcon {...props} icon={(
                <>
                    <rect width="18" height="18" x="3" y="3" rx="2" ry="2" />
                    <line x1="12" x2="12" y1="3" y2="21" />
                </>
            )}/>
        );
        const AlertTriangle = (props) => (
            <LucideIcon {...props} icon={(
                <>
                    <path d="m21.73 18-9-15.57L3.27 18Z" />
                    <path d="M12 9v4" />
                    <path d="M12 17h.01" />
                </>
            )}/>
        );
        
        // --- React Component ---
        const LabelMaker = () => {
            const { useState } = React;

            const [address, setAddress] = useState("John Doe\n123 Maple Street\nSpringfield, IL 62704\nUnited States");
            const [fontSize, setFontSize] = useState(12);
            const [showBorders, setShowBorders] = useState(true);
            const [isBold, setIsBold] = useState(false);
            const [numColumns, setNumColumns] = useState(5);
            const [numRows, setNumRows] = useState(25); 
            const [showPopupWarning, setShowPopupWarning] = useState(false);

            const totalLabels = numRows * numColumns;
            const labels = Array.from({ length: totalLabels });

            // Function to generate the self-contained HTML content for printing/export
            const generateLabelHtml = (title = 'Address Labels for Output') => {
                const addressHtml = address.replace(/\n/g, '<br/>');
                const borderStyle = showBorders ? '1px dotted #9ca3af' : 'none';
                const fontWeight = isBold ? 'bold' : 'normal';
                
                // 1. Generate the inner HTML content (the labels)
                const labelContent = labels.map(() => `
                <div style="
                    height: auto;
                    min-height: 35mm;
                    padding: 0.5rem;
                    font-size: ${fontSize}px;
                    font-weight: ${fontWeight};
                    border: ${borderStyle};
                    display: flex;
                    flex-direction: column;
                    justify-content: flex-start; 
                    align-items: flex-start;
                    text-align: left !important; /* Safety override 1 */
                    break-inside: avoid;
                    page-break-inside: avoid;
                ">
                    <div style="white-space: pre-wrap; line-height: 1.2; text-align: left !important; width: 100%; margin: 0;"> 
                    <br/>${addressHtml || "Recipient Name<br/>Address Line 1<br/>City, State, Zip"}
                    </div>
                </div>
                `).join('');

                // 2. Generate the complete HTML document with embedded styles
                return `
                <!DOCTYPE html>
                <html lang="en">
                <head>
                    <meta charset="UTF-8">
                    <meta name="viewport" content="width=device-width, initial-scale=1.0">
                    <title>${title}</title>
                    <style>
                        body { 
                            margin: 0; 
                            padding: 0; 
                            font-family: Inter, sans-serif;
                            /* REMOVED: margin-top: 1cm; to revert the previous change */
                        }
                        .label-grid {
                            display: grid;
                            grid-template-columns: repeat(${numColumns}, 1fr);
                            width: 210mm; /* A4 width */
                            border-collapse: collapse;
                            text-align: left !important; /* NEW: Targetting the grid container */
                        }
                        /* Print layout configuration for typical A4/Letter size */
                        @page {
                            margin: 0.5cm;
                            size: auto;
                        }
                    </style>
                </head>
                <body>
                    <div class="label-grid">
                        ${labelContent}
                    </div>
                </body>
                </html>
                `;
            };

            const handlePrint = () => {
                const title = 'Address Labels - Print';
                const htmlContent = generateLabelHtml(title);
                
                const printWindow = window.open('', '_blank');
                
                if (printWindow) {
                    printWindow.document.write(htmlContent);
                    printWindow.document.close();
                    setShowPopupWarning(false);
                    
                    setTimeout(() => {
                        if (!printWindow.closed) {
                            printWindow.focus(); 
                            printWindow.print();
                        }
                    }, 200);

                } else {
                    setShowPopupWarning(true);
                    console.error("Popup blocked. Cannot open new tab for printing.");
                }
            };
            
            return (
                <div className="min-h-screen bg-neutral-50 font-sans text-gray-800 p-4 sm:p-8 print:p-0 print:bg-white transition-colors duration-300">
                
                {/* ----------------- CONTROLS ----------------- */}
                <div className="max-w-4xl mx-auto mb-8 bg-white p-4 sm:p-6 rounded-2xl shadow-2xl border border-neutral-100 print:hidden">
                    <div className="flex items-center gap-4 mb-6 border-b border-neutral-200 pb-4">
                        <LayoutGrid className="text-indigo-600 w-8 h-8" />
                        <div>
                            <h1 className="text-xl sm:text-2xl font-extrabold text-neutral-900">Label Sheet Designer</h1>
                            <p className="text-xs sm:text-sm text-neutral-500">Generates {numRows} rows with {numColumns} columns ({totalLabels} labels)</p>
                        </div>
                    </div>

                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6 sm:gap-8">
                        <div className="space-y-4">
                            <label className="block text-sm font-semibold text-neutral-700">Enter Address</label>
                            <textarea
                                // RETAINED: Allows newline characters (Enter key) to be stored correctly.
                                value={address}
                                onChange={(e) => setAddress(e.target.value)} 
                                className="w-full h-32 p-4 border border-neutral-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 shadow-none resize-none transition-all duration-200"
                                placeholder="Type address here..."
                            />
                        </div>

                        <div className="space-y-6">
                            <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                {/* Font Size Control */}
                                <div>
                                    <label className="flex items-center gap-2 text-sm font-semibold text-neutral-700 mb-2">
                                        <Type className="w-4 h-4 text-indigo-600" />
                                        Font Size: {fontSize}px
                                    </label>
                                    <input
                                        type="range"
                                        min="8"
                                        max="24"
                                        value={fontSize}
                                        onChange={(e) => setFontSize(Number(e.target.value))}
                                        className="w-full h-2 bg-neutral-200 rounded-lg appearance-none cursor-pointer accent-indigo-600 transition-colors duration-200"
                                    />
                                </div>

                                {/* Columns Control */}
                                <div>
                                    <label className="flex items-center gap-2 text-sm font-semibold text-neutral-700 mb-2">
                                        <Columns className="w-4 h-4 text-indigo-600" />
                                        Columns
                                    </label>
                                    <div className="flex bg-indigo-100 rounded-xl p-1 shadow-inner">
                                        {[2, 3, 4, 5].map((num) => (
                                            <button
                                                key={num}
                                                onClick={() => setNumColumns(num)}
                                                className={`flex-1 py-1 px-2 text-sm rounded-lg transition-all duration-200 ${
                                                    numColumns === num
                                                    ? 'bg-indigo-600 text-white shadow-md font-bold'
                                                    : 'text-indigo-700 hover:bg-indigo-200'
                                                }`}
                                            >
                                                {num}
                                            </button>
                                        ))}
                                    </div>
                                </div>

                                {/* Rows Control */}
                                <div className="col-span-1">
                                    <label className="flex items-center gap-2 text-sm font-semibold text-neutral-700 mb-2">
                                        <LayoutGrid className="w-4 h-4 text-indigo-600" />
                                        Number of Rows: {numRows}
                                    </label>
                                    <input
                                        type="range"
                                        min="10" 
                                        max="30" 
                                        step="1"
                                        value={numRows}
                                        onChange={(e) => setNumRows(Number(e.target.value))}
                                        className="w-full h-2 bg-neutral-200 rounded-lg appearance-none cursor-pointer accent-indigo-600 transition-colors duration-200"
                                    />
                                </div>

                                {/* Style Checkboxes */}
                                <div className="col-span-1 flex flex-col justify-end gap-3 pb-1 text-sm font-medium">
                                    <label htmlFor="boldCheck" className="flex items-center gap-2 text-neutral-700 cursor-pointer">
                                        <input 
                                            type="checkbox" 
                                            id="boldCheck" 
                                            checked={isBold} 
                                            onChange={(e) => setIsBold(e.target.checked)}
                                            className="w-4 h-4 text-indigo-600 rounded-sm focus:ring-indigo-500 transition-colors duration-200"
                                        />
                                        <Bold className="w-4 h-4 text-neutral-500" /> Bold Text
                                    </label>

                                    <label htmlFor="borderCheck" className="flex items-center gap-2 text-neutral-700 cursor-pointer">
                                        <input 
                                            type="checkbox" 
                                            id="borderCheck" 
                                            checked={showBorders} 
                                            onChange={(e) => setShowBorders(e.target.checked)}
                                            className="w-4 h-4 text-indigo-600 rounded-sm focus:ring-indigo-500 transition-colors duration-200"
                                        />
                                        Show dotted borders
                                    </label>
                                </div>
                            </div>

                            {showPopupWarning && (
                                <div className="flex items-center gap-3 p-3 text-sm text-red-800 bg-red-100 border border-red-300 rounded-xl shadow-inner mt-4">
                                    <AlertTriangle className="w-5 h-5 flex-shrink-0" />
                                    Browser prevented popup. Please allow popups to print.
                                </div>
                            )}

                            <div className="grid grid-cols-1 gap-3 mt-4">
                                <button
                                    type="button"
                                    onClick={handlePrint}
                                    className="w-full flex items-center justify-center gap-2 bg-indigo-600 hover:bg-indigo-700 text-white font-extrabold py-3 rounded-3xl transition-all duration-200 shadow-xl shadow-indigo-500/50 hover:shadow-2xl hover:shadow-indigo-500/60 transform hover:scale-[1.01] active:scale-[0.99]"
                                >
                                    <Printer className="w-5 h-5" />
                                    Print Labels
                                </button>
                            </div>

                            <div className="text-sm text-neutral-500 text-center space-y-1 bg-indigo-50 p-3 rounded-xl border border-indigo-200 mt-4">
                                <p>The **Print** button opens a new tab, displays the final layout, and triggers the print dialog.</p>
                            </div>
                        </div>
                    </div>
                </div>

                {/* ----------------- LABEL GRID ----------------- */}
                <div 
                    id="printable-area" 
                    className="mx-auto bg-white shadow-2xl print:shadow-none print:w-full rounded-2xl overflow-hidden border border-neutral-200"
                    style={{ width: '210mm' }} // A4 width approx, serves as visual preview width
                >
                    <div 
                        className={`grid`}
                        style={{ 
                            display: 'grid',
                            gridTemplateColumns: `repeat(${numColumns}, 1fr)`,
                        }}
                    >
                        {labels.map((_, index) => (
                            <div
                                key={index}
                                className={`
                                    flex flex-col justify-center items-start text-left overflow-hidden
                                    ${showBorders ? 'border border-dotted border-gray-400 border-collapse' : 'border border-transparent'}
                                `}
                                style={{
                                    height: 'auto', 
                                    minHeight: '35mm', 
                                    padding: '0.5rem',
                                    fontSize: `${fontSize}px`,
                                    pageBreakInside: 'avoid', 
                                    breakInside: 'avoid'
                                }}
                            >
                                {/* Added <br/> here to create a blank line at the top of the label content */}
                                <div className={`whitespace-pre-wrap leading-tight text-left w-full ${isBold ? 'font-bold' : 'font-normal'}`}>
                                    {address || "Recipient Name\nAddress Line 1\nCity, State, Zip"}
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
            </div>
            );
        };

        // 4. Render the component to the DOM
        const container = document.getElementById('root');
        const root = ReactDOM.createRoot(container);
        root.render(<LabelMaker />);

    </script>
</body>
</html>